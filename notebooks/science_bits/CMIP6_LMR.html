

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>PaMoDaCo: CMIP6 vs LMR &#8212; LMR-CMIP6 Paleobook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/science_bits/CMIP6_LMR';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Visualizing multivariate, spatio-temporal information in the Cloud with widgets" href="VICS_dashboard.html" />
    <link rel="prev" title="A short introduction to widgets" href="../lifehacks/widget_primer.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    LMR-CMIP6 Paleobook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lifehacks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lifehacks/data_from_esm_cloudcat.html">Accessing CMIP6 output with <code class="docutils literal notranslate"><span class="pre">intake</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../lifehacks/spatial_snapshots_xarray_bonuses.html">Leveraging <code class="docutils literal notranslate"><span class="pre">Xarray</span></code> for spatiotemporal diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lifehacks/widget_primer.html">A short introduction to widgets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Science Bits</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">PaMoDaCo: CMIP6 vs LMR</a></li>
<li class="toctree-l1"><a class="reference internal" href="VICS_dashboard.html">Visualizing multivariate, spatio-temporal information in the Cloud with widgets</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/LinkedEarth/LMR_CMIP_paleobook/main?urlpath=lab/tree/docs/notebooks/science_bits/CMIP6_LMR.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LinkedEarth/LMR_CMIP_paleobook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LinkedEarth/LMR_CMIP_paleobook/issues/new?title=Issue%20on%20page%20%2Fnotebooks/science_bits/CMIP6_LMR.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/science_bits/CMIP6_LMR.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>PaMoDaCo: CMIP6 vs LMR</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-model-comparison-of-global-mean-surface-temperature">Data-model comparison of global-mean surface temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#last-millennium-reanalysis-project-lmr">Last Millennium Reanalysis Project (LMR)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip6-pmip4">CMIP6 &amp; PMIP4</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cloud-ready-data">Cloud-ready data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pulling-data">Pulling Data</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#google-cloud">Google Cloud</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pangeo-forge">Pangeo-Forge</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-data">Processing data</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#miroc">MIROC</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#mri">MRI</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#mpi">MPI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-simulations-to-reconstructions">Comparing simulations to reconstructions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-visualization">Spatial Visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lmr">LMR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip6">CMIP6</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-figure">Combined figure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-and-references">Resources and references</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="pamodaco-cmip6-vs-lmr">
<h1>PaMoDaCo: CMIP6 vs LMR<a class="headerlink" href="#pamodaco-cmip6-vs-lmr" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>This notebook compares the output of physics-based models of the climate of the past millennium to reconstructions from the Last Millennium Reanalysis project and allows a quick glance at the simulated and reconstructed climate response to major volcanic events of the Common Era. In the process, it illustrates how to:</p>
<ol class="arabic simple">
<li><p>Pull and process CMIP6 output from Google Cloud</p></li>
<li><p>Plot an envelope of LMR simulations with CMIP6 output</p></li>
<li><p>Plot spatial variations of reconstructed and simulated snapshots</p></li>
</ol>
<ul class="simple">
<li><p><strong>Time to learn</strong>: 25 minutes</p></li>
</ul>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">#</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Concepts</p></th>
<th class="head"><p>Importance</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://foundations.projectpythia.org/core/cartopy/cartopy.html">Intro to Cartopy</a></p></td>
<td><p>Necessary</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html">Understanding of NetCDF</a></p></td>
<td><p>Helpful</p></td>
<td><p>Familiarity with metadata structure</p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">Accessing CMIP6 output from the cloud</span></p></td>
<td><p>Helpful</p></td>
<td><p>Background about the structure of the data catalog</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">cftime</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>

<span class="kn">import</span> <span class="nn">pyleoclim</span> <span class="k">as</span> <span class="nn">pyleo</span>

<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">import</span> <span class="nn">cartopy.util</span> <span class="k">as</span> <span class="nn">cutil</span>

<span class="kn">import</span> <span class="nn">intake</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-model-comparison-of-global-mean-surface-temperature">
<h2>Data-model comparison of global-mean surface temperature<a class="headerlink" href="#data-model-comparison-of-global-mean-surface-temperature" title="Permalink to this heading">#</a></h2>
<section id="last-millennium-reanalysis-project-lmr">
<h3>Last Millennium Reanalysis Project (LMR)<a class="headerlink" href="#last-millennium-reanalysis-project-lmr" title="Permalink to this heading">#</a></h3>
<p>Many methods have been proposed to reconstruct past climates. An increasingly mature and popular framework is that of <a class="reference external" href="https://pastglobalchanges.org/publications/pages-magazines/pages-magazine/7318">paleoclimate data assimilation</a>, which has been applied to many time intervals. In particular, the <a class="reference external" href="https://cpo.noaa.gov/News/News-Article/ArtMID/6226/ArticleID/1807/Last-Millennium-Reanalysis-now-at-NOAAs-National-Centers-for-Environmental-Information-marking-major-milestone">Last Millennium Reanalysis</a> provides estimates of gridded climate fields like surface air temperature, sea-level pressure, precipitation, and others, together with estimates of their uncertainties (which are often at least as important as the central estimates). (Hakim et al, 2016 and Tardif et al, 2019)</p>
<p>In a nutshell, LMR blends information from paleoclimate proxies and climate models, with models providing estimates of relationships over space and between variables, while proxies give the timing and amplitude of events. To explore the full distribution of possible trajectories, LMR uses an <a class="reference external" href="https://en.wikipedia.org/wiki/Ensemble_Kalman_filter">ensemble Kalman filter</a>, which employs a Monte Carlo approach to this exploration: each reconstruction starts with a sample of 100 randomly-drawn climate snapshots from a model simulation (each such snapshot - a year - is called a <em>member</em>). Proxy measurements for each year are used to establish the likelihood of each climate snapshot. In addition, the algorithm conducts 20-50 “iterations”, where it selects 75% of the catalog of proxies and reserves the other 25% for validation.
By doing this many times (50 iterations each with different 100 snapshots) we can build a 5000-strong picture of how the climate of the Common Era may have unfolded, capturing uncertainties about this history.</p>
<p>We’ll load datasets using <strong><a class="reference external" href="https://xarray.dev/">Xarray</a></strong>. Xarray is specifically designed to accommodate multidimensional data, like that from a NetCDF file. Let’s load 1000 traces of GMST reconstructed using LMR, as presened in Neukom et al. (2019).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;data/p2k_ngeo19_recons.nc&#39;</span>
<span class="n">p2k_nc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
<span class="n">p2k_nc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (year: 2000, ens: 1000)
Coordinates:
  * year     (year) int64 1 2 3 4 5 6 7 8 ... 1994 1995 1996 1997 1998 1999 2000
  * ens      (ens) int64 1 2 3 4 5 6 7 8 9 ... 993 994 995 996 997 998 999 1000
Data variables:
    LMRv2.1  (year, ens) float32 ...
    BHM      (year, ens) float64 ...
    DA       (year, ens) float64 ...
    CPS_new  (year, ens) float64 ...
    CPS      (year, ens) float64 ...
    OIE      (year, ens) float64 ...
    PAI      (year, ens) float64 ...
    PCR      (year, ens) float64 ...
    M08      (year, ens) float64 ...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-7fcd0e6c-9057-444a-89a9-fa092afee1bc' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-7fcd0e6c-9057-444a-89a9-fa092afee1bc' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>year</span>: 2000</li><li><span class='xr-has-index'>ens</span>: 1000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-32046e20-517a-4874-80fd-3d9de1bf7a76' class='xr-section-summary-in' type='checkbox'  checked><label for='section-32046e20-517a-4874-80fd-3d9de1bf7a76' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 ... 1997 1998 1999 2000</div><input id='attrs-3e0b35b4-0c2f-49f1-8dae-c665f9ddac4e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3e0b35b4-0c2f-49f1-8dae-c665f9ddac4e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-661d8419-a9fa-4476-bfbb-809343a770d7' class='xr-var-data-in' type='checkbox'><label for='data-661d8419-a9fa-4476-bfbb-809343a770d7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   1,    2,    3, ..., 1998, 1999, 2000])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ens</span></div><div class='xr-var-dims'>(ens)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 ... 996 997 998 999 1000</div><input id='attrs-2e05abb9-8687-4446-91bb-a9ce77a68e52' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2e05abb9-8687-4446-91bb-a9ce77a68e52' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d9fad288-e5ca-48c1-bf2d-eeb4b0f2153f' class='xr-var-data-in' type='checkbox'><label for='data-d9fad288-e5ca-48c1-bf2d-eeb4b0f2153f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   1,    2,    3, ...,  998,  999, 1000])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2c1c7a0e-da78-4fea-95bd-4430ddc1f7c9' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2c1c7a0e-da78-4fea-95bd-4430ddc1f7c9' class='xr-section-summary' >Data variables: <span>(9)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>LMRv2.1</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-7f639b5e-bb9f-44a5-9d10-87733a53995c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7f639b5e-bb9f-44a5-9d10-87733a53995c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7486fb6b-8f34-470f-9ee8-a64f29b75fdd' class='xr-var-data-in' type='checkbox'><label for='data-7486fb6b-8f34-470f-9ee8-a64f29b75fdd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>BHM</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-a9bce873-5f50-4f8f-b945-9c9308ab79eb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a9bce873-5f50-4f8f-b945-9c9308ab79eb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6e763747-cd1f-41f5-a530-95fbeff5113e' class='xr-var-data-in' type='checkbox'><label for='data-6e763747-cd1f-41f5-a530-95fbeff5113e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>DA</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-faca9061-a699-4f6c-97ae-8ec0ec8264de' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-faca9061-a699-4f6c-97ae-8ec0ec8264de' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6da6d5f8-8d56-4e68-b86c-eed288c29718' class='xr-var-data-in' type='checkbox'><label for='data-6da6d5f8-8d56-4e68-b86c-eed288c29718' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>CPS_new</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-ddb83953-2c81-4eec-82c9-6a9d45fb4a0d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ddb83953-2c81-4eec-82c9-6a9d45fb4a0d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f9b097f0-e09e-46e5-b030-850a91c378c9' class='xr-var-data-in' type='checkbox'><label for='data-f9b097f0-e09e-46e5-b030-850a91c378c9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>CPS</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-536ef1f0-e673-43c2-944b-bdc7465e385d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-536ef1f0-e673-43c2-944b-bdc7465e385d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d5b6b42f-42d3-4fc3-af23-9d2031a4e3de' class='xr-var-data-in' type='checkbox'><label for='data-d5b6b42f-42d3-4fc3-af23-9d2031a4e3de' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>OIE</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-27af59ab-7e8d-44ad-9f4f-a984d99b793e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-27af59ab-7e8d-44ad-9f4f-a984d99b793e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cec390b1-8f1f-4d0f-8611-cdb4f279d0f4' class='xr-var-data-in' type='checkbox'><label for='data-cec390b1-8f1f-4d0f-8611-cdb4f279d0f4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>PAI</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-2bbbb216-3635-414a-bd13-4162e9bd106e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2bbbb216-3635-414a-bd13-4162e9bd106e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a7076153-1980-46dc-b7ce-6ecf67420d14' class='xr-var-data-in' type='checkbox'><label for='data-a7076153-1980-46dc-b7ce-6ecf67420d14' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>PCR</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-e110aac3-fe42-4fb3-b6b8-f1c20e850896' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e110aac3-fe42-4fb3-b6b8-f1c20e850896' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-78330815-9698-40dd-a0f6-ec921a90e146' class='xr-var-data-in' type='checkbox'><label for='data-78330815-9698-40dd-a0f6-ec921a90e146' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>M08</span></div><div class='xr-var-dims'>(year, ens)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-7516e24b-1ac1-42f3-a3cd-01696e2ce966' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7516e24b-1ac1-42f3-a3cd-01696e2ce966' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0e78170c-9f7d-4a02-9a72-deca0b2e0ba0' class='xr-var-data-in' type='checkbox'><label for='data-0e78170c-9f7d-4a02-9a72-deca0b2e0ba0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[2000000 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-34d8d4ee-c279-4ad2-aea3-3865114927e9' class='xr-section-summary-in' type='checkbox'  ><label for='section-34d8d4ee-c279-4ad2-aea3-3865114927e9' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>year</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-65f7a591-8dda-4357-a95a-24b2817cb77a' class='xr-index-data-in' type='checkbox'/><label for='index-65f7a591-8dda-4357-a95a-24b2817cb77a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   1,    2,    3,    4,    5,    6,    7,    8,    9,   10,
       ...
       1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000],
      dtype=&#x27;int64&#x27;, name=&#x27;year&#x27;, length=2000))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>ens</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-2a07371a-c50b-4942-9648-abca3b2113c0' class='xr-index-data-in' type='checkbox'/><label for='index-2a07371a-c50b-4942-9648-abca3b2113c0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   1,    2,    3,    4,    5,    6,    7,    8,    9,   10,
       ...
        991,  992,  993,  994,  995,  996,  997,  998,  999, 1000],
      dtype=&#x27;int64&#x27;, name=&#x27;ens&#x27;, length=1000))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-af35ea5f-2de1-4ebf-812a-9033f3a8bf22' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-af35ea5f-2de1-4ebf-812a-9033f3a8bf22' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LMRv2.1&#39;</span>
<span class="n">ens_grps</span> <span class="o">=</span> <span class="n">p2k_nc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ens&#39;</span><span class="p">)</span>
<span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p2k_nc</span><span class="o">.</span><span class="n">ens</span><span class="p">)):</span>
    <span class="n">ens_run</span> <span class="o">=</span> <span class="n">ens_grps</span><span class="p">[</span><span class="n">im</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data_vars</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
    <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">p2k_nc</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ens_run</span><span class="p">,</span>
                      <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
                      <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;GMST&#39;</span><span class="p">,</span> <span class="n">value_unit</span><span class="o">=</span><span class="s1">&#39;$^{\circ}$C&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">lmr_ens</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">EnsembleSeries</span><span class="p">(</span><span class="n">traces</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.88 s, sys: 60.2 ms, total: 1.94 s
Wall time: 2.14 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lmr_ens</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;LMR ensemble&#39;</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">curve_clr</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0057f7a9266d4b4fab50790d57843082c8225682981c2af0054921591121ad3c.png" src="../../_images/0057f7a9266d4b4fab50790d57843082c8225682981c2af0054921591121ad3c.png" />
</div>
</div>
</section>
<section id="cmip6-pmip4">
<h3>CMIP6 &amp; PMIP4<a class="headerlink" href="#cmip6-pmip4" title="Permalink to this heading">#</a></h3>
<p>The Climate Model Intercomparison Project Phase 6 (CMIP6) is a major international effort to organize climate simulations by specifying a standardized menu of experiments, providing data-sharing infrastructure (which guides output toward a homogeneous structure and nomenclature), and requiring each participating model to submit the following entry card simulations as a baseline:</p>
<ul class="simple">
<li><p>Pre-industrial control (piControl)</p></li>
<li><p>Abrupt-4xCO2</p></li>
<li><p>1% per year increase in CO2 (1pctCO2)</p></li>
<li><p>Atmospheric Model Intercomparison Project (AMIP)</p></li>
<li><p>Simulations of the period 1850-2014 (historical)</p></li>
</ul>
<p>The Paleoclimate Modeling Intercomparison Project (PMIP) component of CMIP6 focused on simulating climate prior to the industrial era. The PMIP community develops forcing files for each experiment based on proxy and other climate data so that each model uses a common set of boundary conditions for factors such as greenhouse gas concentrations, solar radiation, land cover, and ice sheet extent. While submitting PMIP simulations is not a requirement for participating in CMIP6, simulating climate beginning with conditions notably different from those specified for the historical benchmark provides important information about the robustness of a model’s physics. All PMIP participants were required to submit output for three entry-card experiments plus any of the optional experiments.  As of spring 2023, output is still coming in from the <a class="reference external" href="https://pmip4.lsce.ipsl.fr/doku.php/database:participants">19 institutions signed up to participate in PMIP4</a>, but so far, data is available via the Earth System Grid Federation for:</p>
<ul class="simple">
<li><p>[entry-card] Mid-Holocene (MH): 16</p></li>
<li><p>[entry-card] Last Glacial Maximum (LGM): 6</p></li>
<li><p>[entry-card] Last Interglacial (LIG): 15</p></li>
<li><p>Last Millennium (past1000): 4</p></li>
<li><p>Past2k (past2k): 1</p></li>
</ul>
<section id="cloud-ready-data">
<h4>Cloud-ready data<a class="headerlink" href="#cloud-ready-data" title="Permalink to this heading">#</a></h4>
<p>Data is readily available for download via the <a class="reference external" href="https://esgf-node.ipsl.upmc.fr/search/cmip6-ipsl/">ESGF website</a>, and additional files may be available by request. However, it isn’t always convenient to maintain a mini CMIP6 catalog locally. In order to encourage analysis of CMIP6 output, Amazon Web Services and Google Cloud have stepped up to make a few petabytes available in a cloud-ready format as part of the <a class="reference external" href="https://aws.amazon.com/opendata/public-datasets/">AWS Open Data Sponsorship Program</a> and <a class="reference external" href="https://cloud.google.com/public-datasets">Google Cloud Public Datasets</a>, respectively. Cloud-ready data can be queried and subsetted remotely, allowing a user to minimize the amount of data that is loaded into memory by only loading on request (for example, to make a plot).</p>
<p>Most data are not published under the unifying hand of an effort like CMIP6, but still yearn to see the light of day. The folks at <a class="reference external" href="https://pangeo-forge.org">Pangeo-Forge</a> have made it their mission to provide infrastructure help community members do the custom configuration needed to make large datasets–often stored in multiple parts–available in a clean, consolidated form via a simple URL.</p>
<p>Voila! Loading large data files (e.g., compilations, model output), goes from being somewhere between challenging and impossible on the average personal computer, to well within reach.</p>
</section>
<section id="pulling-data">
<h4>Pulling Data<a class="headerlink" href="#pulling-data" title="Permalink to this heading">#</a></h4>
<p>In order to look at the interval 850 to present (ish), we’ll need output from both the “historical” CMIP6 entry card runs and the PMIP “past1000k” experiment.</p>
<p>While the CMIP6 historical output is available for all three via Google Cloud (the Google Cloud and Google Cloud offerings were the same at this writing), the same cannot be said of PMIP output. Happily, a select set of PMIP experimental output is available via Pangeo-Forge.</p>
<p>PMIP output for <code class="docutils literal notranslate"><span class="pre">tas</span></code> available via cloud pointer:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MIROC-ES2L.past1000.r1i1p1f2.Amon.tas</span></code> (Pangeo-Forge)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MRI-ESM2-0.past1000.r1i1p1f1.Amon.tas</span></code> (Pangeo-Forge, Google Cloud)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI-ESM1-2-LR.past2k.r1i1p1f1.Amon.tas</span></code> (Pangeo-Forge)</p></li>
</ul>
<p>Let’s tap Pangeo-Forge for PMIP, and Google Cloud for CMIP.</p>
<section id="google-cloud">
<h5>Google Cloud<a class="headerlink" href="#google-cloud" title="Permalink to this heading">#</a></h5>
<p>To get data from Google Cloud, we will use <code class="docutils literal notranslate"><span class="pre">intake</span></code> to load a json file with information about the Google Cloud holdings, query it, and then pull the output of interest. For a deeper dive into using intake to query CMIP6 holdings, check out <a class="reference internal" href="../lifehacks/data_from_esm_cloudcat.html"><span class="doc std std-doc">this lifehack</span></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for AWS S3</span>
<span class="c1"># cat_url = &quot;https://cmip6-pds.s3.amazonaws.com/pangeo-cmip6.json&quot;</span>

<span class="c1"># for google:</span>
<span class="n">cat_url</span> <span class="o">=</span> <span class="s2">&quot;https://storage.googleapis.com/cmip6/pangeo-cmip6.json&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span><span class="n">cat_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;historical&#39;</span><span class="p">,</span> <span class="s1">&#39;past1000&#39;</span><span class="p">]</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MIROC-ES2L&#39;</span><span class="p">,</span> <span class="s1">&#39;MRI-ESM2-0&#39;</span><span class="p">,</span> <span class="s1">&#39;MPI-ESM1-2-LR&#39;</span><span class="p">]</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span>
<span class="n">members</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r1i1p1f1&#39;</span><span class="p">,</span> <span class="s1">&#39;r1i1p1f2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query_d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="n">sources</span><span class="p">,</span> 
     <span class="n">experiment_id</span><span class="o">=</span><span class="n">experiments</span><span class="p">,</span> 
     <span class="n">grid_label</span><span class="o">=</span><span class="s1">&#39;gn&#39;</span><span class="p">,</span> 
     <span class="n">variable_id</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> 
     <span class="n">member_id</span> <span class="o">=</span> <span class="n">members</span><span class="p">,</span>
     <span class="n">table_id</span><span class="o">=</span><span class="s1">&#39;Amon&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_res</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">**</span><span class="n">query_d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_res</span><span class="o">.</span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>activity_id</th>
      <th>institution_id</th>
      <th>source_id</th>
      <th>experiment_id</th>
      <th>member_id</th>
      <th>table_id</th>
      <th>variable_id</th>
      <th>grid_label</th>
      <th>zstore</th>
      <th>dcpp_init_year</th>
      <th>version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CMIP</td>
      <td>MRI</td>
      <td>MRI-ESM2-0</td>
      <td>historical</td>
      <td>r1i1p1f1</td>
      <td>Amon</td>
      <td>tas</td>
      <td>gn</td>
      <td>gs://cmip6/CMIP6/CMIP/MRI/MRI-ESM2-0/historica...</td>
      <td>NaN</td>
      <td>20190222</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CMIP</td>
      <td>MPI-M</td>
      <td>MPI-ESM1-2-LR</td>
      <td>historical</td>
      <td>r1i1p1f1</td>
      <td>Amon</td>
      <td>tas</td>
      <td>gn</td>
      <td>gs://cmip6/CMIP6/CMIP/MPI-M/MPI-ESM1-2-LR/hist...</td>
      <td>NaN</td>
      <td>20190710</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CMIP</td>
      <td>MIROC</td>
      <td>MIROC-ES2L</td>
      <td>historical</td>
      <td>r1i1p1f2</td>
      <td>Amon</td>
      <td>tas</td>
      <td>gn</td>
      <td>gs://cmip6/CMIP6/CMIP/MIROC/MIROC-ES2L/histori...</td>
      <td>NaN</td>
      <td>20190823</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PMIP</td>
      <td>MRI</td>
      <td>MRI-ESM2-0</td>
      <td>past1000</td>
      <td>r1i1p1f1</td>
      <td>Amon</td>
      <td>tas</td>
      <td>gn</td>
      <td>gs://cmip6/CMIP6/PMIP/MRI/MRI-ESM2-0/past1000/...</td>
      <td>NaN</td>
      <td>20200120</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span>
<span class="n">_esm_data_d</span> <span class="o">=</span> <span class="n">search_res</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">require_all_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_label&#39;</span><span class="p">,</span> <span class="s1">&#39;table_id&#39;</span><span class="p">,</span> <span class="s1">&#39;variant_label&#39;</span><span class="p">],</span><span class="c1">#[&#39;source_id&#39;, &#39;experiment_id&#39;], </span>
                                      <span class="n">xarray_open_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span><span class="s1">&#39;use_cftime&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;chunks&#39;</span><span class="p">:{}},</span>
                                      <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="s1">&#39;anon&#39;</span><span class="p">}</span>
                                        <span class="p">)</span>
<span class="n">_esm_data_d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2 µs, sys: 1e+03 ns, total: 3 µs
Wall time: 5.72 µs

--&gt; The keys in the returned dictionary of datasets are constructed as follows:
	&#39;activity_id.institution_id.source_id.experiment_id.table_id.grid_label&#39;
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
    <div>
      <progress value='4' class='' max='4' style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [4/4 00:00&lt;00:00]
    </div>
    </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;PMIP.MRI.MRI-ESM2-0.past1000.Amon.gn&#39;, &#39;CMIP.MRI.MRI-ESM2-0.historical.Amon.gn&#39;, &#39;CMIP.MPI-M.MPI-ESM1-2-LR.historical.Amon.gn&#39;, &#39;CMIP.MIROC.MIROC-ES2L.historical.Amon.gn&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">esm_data_d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_esm_data_d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">esm_data_d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">esm_data_d</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">esm_data_d</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_esm_data_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pangeo-forge">
<h5>Pangeo-Forge<a class="headerlink" href="#pangeo-forge" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PF_cloud_pointers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MIROC&#39;</span><span class="p">:</span> <span class="s1">&#39;https://ncsa.osn.xsede.org/Pangeo/pangeo-forge/pangeo-forge/CMIP6-PMIP-feedstock/CMIP6.PMIP.MIROC.MIROC-ES2L.past1000.r1i1p1f2.Amon.tas.gn.v20200318.zarr&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;MRI&#39;</span><span class="p">:</span> <span class="s1">&#39;https://ncsa.osn.xsede.org/Pangeo/pangeo-forge/pangeo-forge/CMIP6-PMIP-feedstock/CMIP6.PMIP.MRI.MRI-ESM2-0.past1000.r1i1p1f1.Amon.tas.gn.v20200120.zarr&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;MPI&#39;</span><span class="p">:</span> <span class="s1">&#39;https://ncsa.osn.xsede.org/Pangeo/pangeo-forge/pangeo-forge/CMIP6-PMIP-feedstock/CMIP6.PMIP.MPI-M.MPI-ESM1-2-LR.past2k.r1i1p1f1.Amon.tas.gn.v20210714.zarr&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PF_data_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">PF_cloud_pointers</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;zarr&#39;</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{},</span> <span class="n">use_cftime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">PF_cloud_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="processing-data">
<h4>Processing data<a class="headerlink" href="#processing-data" title="Permalink to this heading">#</a></h4>
<p>Data in hand, we need to check that they follow the structure we are expecting, and tune that structure where appropriate. Groups participating in PMIP do their best to standardize output according to CMIP6 guidelines, but idiosyncrasies remain. For each output, we will iron them out, and then continue with our calculations.</p>
<p>Once we know the data are orderly, we will calculate the global mean annual surface air temperature anomaly relative to the interval 1900-1980, per the approach used for the LMR 2.1 data loaded above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_climatology</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;time.month&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
        <span class="n">interval_ds</span> <span class="o">=</span> <span class="n">ds</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interval_ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">interval</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">interval</span><span class="p">)))</span>
    <span class="n">climatology</span> <span class="o">=</span> <span class="n">interval_ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">time_unit</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">climatology</span>

<span class="k">def</span> <span class="nf">remove_seasonality</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">climatology</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;time.month&#39;</span><span class="p">):</span>
    <span class="n">anomalies</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">time_unit</span><span class="p">)</span> <span class="o">-</span> <span class="n">climatology</span>
    <span class="k">return</span> <span class="n">anomalies</span>

<span class="k">def</span> <span class="nf">global_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lat_weighted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">lat_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span>
        <span class="n">lat_weights</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;lat_weights&quot;</span>

        <span class="n">ds_lat_weighted</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">lat_weights</span><span class="p">)</span>
        <span class="n">ds_global_mean</span> <span class="o">=</span> <span class="n">ds_lat_weighted</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ds_global_mean</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ds_global_mean</span>

<span class="k">def</span> <span class="nf">annualize</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">ds_annualized</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_annualized</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_da_ps</span><span class="p">(</span><span class="n">da</span><span class="p">):</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> 
                                <span class="n">clean_ts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Temp anomaly ($^{\circ}$C)&#39;</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1">#atm temp @2m&#39;)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;da&#39;</span><span class="p">:</span> <span class="n">da</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="s1">&#39;ps&#39;</span><span class="p">:</span><span class="n">ps</span><span class="p">}</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annualized_anomaly_gwm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">annualized_anomaly_spatial</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<section id="miroc">
<h5>MIROC<a class="headerlink" href="#miroc" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miroc_model</span> <span class="o">=</span> <span class="s1">&#39;MIROC-ES2L&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_miroc_past1000</span> <span class="o">=</span> <span class="n">PF_data_d</span><span class="p">[</span><span class="s1">&#39;MIROC&#39;</span><span class="p">]</span>
<span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">dims</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Frozen({&#39;lat&#39;: 64, &#39;bnds&#39;: 2, &#39;lon&#39;: 128, &#39;time&#39;: 12011})
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">time:</span> <span class="pre">12011</span></code> is a bit suspicious. Checking for a hiccough never hurts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr</span><span class="o">.</span><span class="n">CFTimeIndex</span><span class="p">(</span><span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">is_monotonic_increasing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>Ah. Finding these wrinkles can be tricky. A simple strategy is to group the data by year and check to see if any years have more than 12 entries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># group by year</span>
<span class="n">miroc_yeargrps</span> <span class="o">=</span> <span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span>

<span class="c1"># years with more than 12 entries</span>
<span class="n">miroc_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">miroc_yeargrps</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">miroc_yeargrps</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">12</span><span class="p">]</span>
<span class="n">miroc_years</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[850]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">time</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([cftime.Datetime360Day(850, 1, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 2, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 3, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 4, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 5, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 6, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 7, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 8, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 9, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 10, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 11, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 1, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.Datetime360Day(850, 2, 15, 0, 0, 0, 0, has_year_zero=True)],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">encoding</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;chunks&#39;: (12011,),
 &#39;preferred_chunks&#39;: {&#39;time&#39;: 12011},
 &#39;compressor&#39;: Blosc(cname=&#39;lz4&#39;, clevel=5, shuffle=SHUFFLE, blocksize=0),
 &#39;filters&#39;: None,
 &#39;units&#39;: &#39;days since 0850-01-16 00:00:00.000000&#39;,
 &#39;calendar&#39;: &#39;360_day&#39;,
 &#39;dtype&#39;: dtype(&#39;int64&#39;)}
</pre></div>
</div>
</div>
</div>
<p>Now we can slice off the initial 11 months and convert the calendar to ‘proleptic_gregorian’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miroc_past1000</span> <span class="o">=</span> <span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="nb">slice</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">_miroc_past1000</span><span class="o">.</span><span class="n">time</span><span class="p">))})</span><span class="c1">#time[:74]</span>
<span class="n">miroc_past1000</span> <span class="o">=</span> <span class="n">miroc_past1000</span><span class="o">.</span><span class="n">convert_calendar</span><span class="p">(</span><span class="s1">&#39;proleptic_gregorian&#39;</span><span class="p">,</span> <span class="n">use_cftime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align_on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s convert the calendar of the <code class="docutils literal notranslate"><span class="pre">historical</span></code> output</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miroc_hist</span> <span class="o">=</span> <span class="n">esm_data_d</span><span class="p">[</span><span class="s1">&#39;MIROC&#39;</span><span class="p">][</span><span class="s1">&#39;MIROC-ES2L&#39;</span><span class="p">][</span><span class="s1">&#39;historical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_calendar</span><span class="p">(</span><span class="s1">&#39;proleptic_gregorian&#39;</span><span class="p">,</span> <span class="n">use_cftime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>                      
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miroc_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;past1000&#39;</span><span class="p">:</span> <span class="n">miroc_past1000</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span> <span class="s1">&#39;historical&#39;</span><span class="p">:</span> <span class="n">miroc_hist</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miroc_climatology</span> <span class="o">=</span> <span class="n">calc_climatology</span><span class="p">(</span><span class="n">miroc_hist</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miroc_annualized_anomaly_spatial</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">annualize</span><span class="p">(</span><span class="n">remove_seasonality</span><span class="p">(</span><span class="n">miroc_exp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">miroc_climatology</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">miroc_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="s1">&#39;MIROC&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">miroc_annualized_anomaly_spatial</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 1000 times more chunks
  return self.array[key]
/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 165 times more chunks
  return self.array[key]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">miroc_yr_gmt_anom</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">calc_da_ps</span><span class="p">(</span><span class="n">annualize</span><span class="p">(</span><span class="n">global_mean</span><span class="p">(</span><span class="n">remove_seasonality</span><span class="p">(</span><span class="n">miroc_exp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">miroc_climatology</span><span class="p">),</span> 
                                                           <span class="n">lat_weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">miroc_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">miroc_yr_gmt_anom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">miroc_yr_gmt_anom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">miroc_model</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span>
    
<span class="n">annualized_anomaly_gwm</span><span class="p">[</span><span class="s1">&#39;MIROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">miroc_yr_gmt_anom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 1000 times more chunks
  return self.array[key]
/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 165 times more chunks
  return self.array[key]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1min 35s, sys: 15.7 s, total: 1min 50s
Wall time: 7min 24s
</pre></div>
</div>
</div>
</div>
</section>
<section id="mri">
<h5>MRI<a class="headerlink" href="#mri" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mri_model</span> <span class="o">=</span> <span class="s1">&#39;MRI-ESM2-0&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mri_past1000</span> <span class="o">=</span> <span class="n">PF_data_d</span><span class="p">[</span><span class="s1">&#39;MRI&#39;</span><span class="p">]</span>
<span class="n">mri_past1000</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">encoding</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;chunks&#39;: (12000,),
 &#39;preferred_chunks&#39;: {&#39;time&#39;: 12000},
 &#39;compressor&#39;: Blosc(cname=&#39;lz4&#39;, clevel=5, shuffle=SHUFFLE, blocksize=0),
 &#39;filters&#39;: None,
 &#39;units&#39;: &#39;hours since 0850-01-16 12:00:00.000000&#39;,
 &#39;calendar&#39;: &#39;proleptic_gregorian&#39;,
 &#39;dtype&#39;: dtype(&#39;int64&#39;)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mri_hist</span> <span class="o">=</span> <span class="n">esm_data_d</span><span class="p">[</span><span class="s1">&#39;MRI&#39;</span><span class="p">][</span><span class="s1">&#39;MRI-ESM2-0&#39;</span><span class="p">][</span><span class="s1">&#39;historical&#39;</span><span class="p">]</span>
<span class="n">mri_hist</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">encoding</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;chunks&#39;: (1980,),
 &#39;preferred_chunks&#39;: {&#39;time&#39;: 1980},
 &#39;compressor&#39;: Blosc(cname=&#39;lz4&#39;, clevel=5, shuffle=SHUFFLE, blocksize=0),
 &#39;filters&#39;: None,
 &#39;_FillValue&#39;: nan,
 &#39;units&#39;: &#39;days since 1850-01-01&#39;,
 &#39;calendar&#39;: &#39;proleptic_gregorian&#39;,
 &#39;dtype&#39;: dtype(&#39;float64&#39;)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mri_climatology</span> <span class="o">=</span> <span class="n">calc_climatology</span><span class="p">(</span><span class="n">mri_hist</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mri_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;past1000&#39;</span><span class="p">:</span> <span class="n">mri_past1000</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span> <span class="s1">&#39;historical&#39;</span><span class="p">:</span> <span class="n">mri_hist</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">mri_annualized_anomaly_spatial</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">annualize</span><span class="p">(</span><span class="n">remove_seasonality</span><span class="p">(</span><span class="n">mri_exp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">mri_climatology</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mri_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="s1">&#39;MRI&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mri_annualized_anomaly_spatial</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 1000 times more chunks
  return self.array[key]
/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 165 times more chunks
  return self.array[key]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 8.07 s, sys: 244 ms, total: 8.31 s
Wall time: 14.8 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">mri_yr_gmt_anom</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">calc_da_ps</span><span class="p">(</span><span class="n">annualize</span><span class="p">(</span><span class="n">global_mean</span><span class="p">(</span><span class="n">remove_seasonality</span><span class="p">(</span><span class="n">mri_exp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">mri_climatology</span><span class="p">),</span> <span class="n">lat_weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mri_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mri_yr_gmt_anom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">mri_yr_gmt_anom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">mri_model</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span>
    
<span class="n">annualized_anomaly_gwm</span><span class="p">[</span><span class="s1">&#39;MRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mri_yr_gmt_anom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 1000 times more chunks
  return self.array[key]
/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 165 times more chunks
  return self.array[key]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1min, sys: 18.9 s, total: 1min 19s
Wall time: 1min 27s
</pre></div>
</div>
</div>
</div>
</section>
<section id="mpi">
<h5>MPI<a class="headerlink" href="#mpi" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpi_model</span> <span class="o">=</span> <span class="s1">&#39;MPI-ESM1-2-LR&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpi_past2k</span> <span class="o">=</span> <span class="n">PF_data_d</span><span class="p">[</span><span class="s1">&#39;MPI&#39;</span><span class="p">]</span>
<span class="n">mpi_past2k</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">encoding</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;chunks&#39;: (22200,),
 &#39;preferred_chunks&#39;: {&#39;time&#39;: 22200},
 &#39;compressor&#39;: Blosc(cname=&#39;lz4&#39;, clevel=5, shuffle=SHUFFLE, blocksize=0),
 &#39;filters&#39;: None,
 &#39;units&#39;: &#39;hours since 7001-01-16 12:00:00.000000&#39;,
 &#39;calendar&#39;: &#39;proleptic_gregorian&#39;,
 &#39;dtype&#39;: dtype(&#39;int64&#39;)}
</pre></div>
</div>
</div>
</div>
<p>Wow… <code class="docutils literal notranslate"><span class="pre">'hours</span> <span class="pre">since</span> <span class="pre">7001-01-16</span> <span class="pre">12:00:00.000000'</span></code></p>
<p>If we shift time back 7001 years, the start year becomes 0 and the end year is 1850, consistent with the fact that the MPI-M output is for the past2k, not past1000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpi_past2k</span> <span class="o">=</span> <span class="n">mpi_past2k</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">CFTimeIndex</span><span class="p">(</span><span class="n">mpi_past2k</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">7001</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">))</span>
<span class="n">mpi_past1000</span> <span class="o">=</span> <span class="n">mpi_past2k</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">mpi_past2k</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">850</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpi_hist</span> <span class="o">=</span> <span class="n">esm_data_d</span><span class="p">[</span><span class="s1">&#39;MPI-M&#39;</span><span class="p">][</span><span class="n">mpi_model</span><span class="p">][</span><span class="s1">&#39;historical&#39;</span><span class="p">]</span>
<span class="n">mpi_hist</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">encoding</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;chunks&#39;: (1980,),
 &#39;preferred_chunks&#39;: {&#39;time&#39;: 1980},
 &#39;compressor&#39;: Blosc(cname=&#39;lz4&#39;, clevel=5, shuffle=SHUFFLE, blocksize=0),
 &#39;filters&#39;: None,
 &#39;units&#39;: &#39;hours since 1850-01-16 12:00:00.000000&#39;,
 &#39;calendar&#39;: &#39;proleptic_gregorian&#39;,
 &#39;dtype&#39;: dtype(&#39;int64&#39;)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpi_climatology</span> <span class="o">=</span> <span class="n">calc_climatology</span><span class="p">(</span><span class="n">mpi_hist</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpi_exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;past1000&#39;</span><span class="p">:</span> <span class="n">mpi_past1000</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span> <span class="s1">&#39;historical&#39;</span><span class="p">:</span> <span class="n">mpi_hist</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">mpi_yr_gmt_anom</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">calc_da_ps</span><span class="p">(</span><span class="n">annualize</span><span class="p">(</span><span class="n">global_mean</span><span class="p">(</span><span class="n">remove_seasonality</span><span class="p">(</span><span class="n">mpi_exp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">mpi_climatology</span><span class="p">),</span> <span class="n">lat_weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mpi_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mpi_yr_gmt_anom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">mpi_yr_gmt_anom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">mpi_model</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span>
    
<span class="n">annualized_anomaly_gwm</span><span class="p">[</span><span class="s1">&#39;MPI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpi_yr_gmt_anom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 1000 times more chunks
  return self.array[key]
/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 165 times more chunks
  return self.array[key]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 44.1 s, sys: 9.57 s, total: 53.6 s
Wall time: 1min
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">mpi_annualized_anomaly_spatial</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">annualize</span><span class="p">(</span><span class="n">remove_seasonality</span><span class="p">(</span><span class="n">mpi_exp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">mpi_climatology</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mpi_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="s1">&#39;MPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mpi_annualized_anomaly_spatial</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 1000 times more chunks
  return self.array[key]
/Users/jlanders/opt/miniconda3/envs/paleobook-dev/lib/python3.10/site-packages/xarray/core/indexing.py:1440: PerformanceWarning: Slicing with an out-of-order index is generating 165 times more chunks
  return self.array[key]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 5.08 s, sys: 92.8 ms, total: 5.18 s
Wall time: 5.31 s
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="comparing-simulations-to-reconstructions">
<h3>Comparing simulations to reconstructions<a class="headerlink" href="#comparing-simulations-to-reconstructions" title="Permalink to this heading">#</a></h3>
<p>We now have all the pieces in hand to compare simulations to reconstructions! Let’s plot the processed model output on top of ensemble plot we made earlier to see whether the model output agrees with the envelope characterized by the LMR reconstructions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

<span class="c1"># Same EnsembleSeries envelope from above, this time with lines that correspond to volcanic events</span>
<span class="n">lmr_ens</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span> <span class="n">shade_alpha</span> <span class="o">=</span> <span class="mf">.1</span><span class="p">,</span>  <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;GMST [$^{\circ}$C]&#39;</span><span class="p">,</span> 
                                                   <span class="n">curve_lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">curve_clr</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">annualized_anomaly_gwm</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">annualized_anomaly_gwm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">annualized_anomaly_gwm</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">exp</span><span class="p">][</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
    
<span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">850</span><span class="p">,</span> <span class="mi">2014</span><span class="p">]</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a8f51af1ce728dd0ce051f0d05c08ab573339b992b3fdc233f640641df781109.png" src="../../_images/a8f51af1ce728dd0ce051f0d05c08ab573339b992b3fdc233f640641df781109.png" />
</div>
</div>
<p>Great! Now we can see how the physics-based GCM simulations compare to the envelope of LMR reconstructions. All three models closely follow the increase captured by the reconstructions over the “historical” period (1850-2014) and show an approximately flat trend over the “past1000k” interval. Different GCMs use different approaches to describe the physics behind earth system processes. Therefore, it is not surprising to see slight offsets among them or differences in the interannual variability superimposed on the trends.</p>
<p>Punctuating the “past1000” interval are a series of abrupt decreases, coincident across all models, that correspond to volcanic eruptions. The recovery period length varies by model, but broadly, the temperature response follows the reconstructed trajectory. Based on these observations, we can conclude that the model physics are true to pre-industrial climate dynamics. Furthermore, the amplitude of the post-1850 increase is too large to be attributed to pre-1850 interannual variability alone, suggesting that anthropogenic forcing must have played a significant role.</p>
</section>
</section>
<section id="spatial-visualization">
<h2>Spatial Visualization<a class="headerlink" href="#spatial-visualization" title="Permalink to this heading">#</a></h2>
<p>The global mean collapses spatial heterogeneity into a single summary statistic that is valuable for looking at over-arching or long-term trends where local nuance would distract. However, spatial patterns are essential for tracking dynamical processes, and are masked by the canceling effects of the spatial averaging inherent in a global mean. In many instances, one might want to diagnose spatio-temporal modes of variability ; we shall do so in a future notebook. For now, let’s just visualize the temperature response to the volcanic erutions mentioned earlier.</p>
<p>In April 5-15 1815, the Tambora volcano erupted, releasing a huge plume of sulfate aerosols into the atmosphere, causing <a class="reference external" href="https://en.wikipedia.org/wiki/Year_Without_a_Summer">global cooling for much of the following year</a>. That is visible in the global mean anomaly timeseries plotted above, but now let’s also look into the spatial distribution for the three models and the LMR reconstruction at that time, and also the time evolution of the temperature anomaly in a specific place (in contrast to the global mean we looked at earlier). The final figure will contain:</p>
<ul class="simple">
<li><p>Four snapshot maps (one for each model + LMR) that show the spatial distribution of temperature anomaly at a particular point in time</p></li>
<li><p>One plot of the time evolution of temperature anomaly at a specific location for each model + LMR</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s select an arbitrary location at which to plot temperature evolution</span>
<span class="n">lat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">lon</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Tambora coordinates </span>
<span class="n">tam_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.2479</span>
<span class="n">tam_lon</span> <span class="o">=</span> <span class="mf">117.9911</span>
<span class="n">time_pt</span> <span class="o">=</span> <span class="mi">1816</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6_snapshot_ps</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<section id="lmr">
<h3>LMR<a class="headerlink" href="#lmr" title="Permalink to this heading">#</a></h3>
<p>Previously, we loaded 1000 traces of LMR global mean temperature anomaly. As a matter of computational practicality, the LMR spatial fields are only available as the ensemble mean for each of 20 iterations. Here, we will load those data from Pangeo-Forge and average over the 20 iterations so that we have a single field at each time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data using Pangeo-Forge</span>
<span class="n">store</span> <span class="o">=</span> <span class="s2">&quot;https://ncsa.osn.xsede.org/Pangeo/pangeo-forge/test/pangeo-forge/staged-recipes/recipe-run-1200/LMRv2p1_MCruns_ensemble_gridded.zarr&quot;</span>
<span class="n">lmr_ds_gridded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;zarr&#39;</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># temperature anomaly</span>
<span class="n">lmr_ds_gridded_temp</span> <span class="o">=</span> <span class="n">lmr_ds_gridded</span><span class="p">[</span><span class="s1">&#39;air_mean&#39;</span><span class="p">]</span>

<span class="c1"># spatial distribution of temperature amomaly (average of members)</span>
<span class="n">lmr_ds_gridded_temp_mean</span> <span class="o">=</span> <span class="n">lmr_ds_gridded_temp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;MCrun&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># this takes about 1.5 minutes</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">lmr_ds_gridded_temp</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">},</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">MCrun_grps</span> <span class="o">=</span> <span class="p">[</span><span class="n">grp</span> <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;MCrun&#39;</span><span class="p">)]</span>
<span class="n">tmp_pss</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">MCrun_grp</span> <span class="ow">in</span> <span class="n">MCrun_grps</span><span class="p">:</span>
    <span class="n">MCrun</span> <span class="o">=</span> <span class="n">MCrun_grp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tmp_pss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">MCrun</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">MCrun</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">clean_ts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;MCrun </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MCrun_grp</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 29.7 s, sys: 10.6 s, total: 40.3 s
Wall time: 2min 46s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surftemp_mean</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;MCrun&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">snapshot_data</span> <span class="o">=</span> <span class="n">lmr_ds_gridded_temp_mean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">lmr_ds_gridded_temp_mean</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">time_pt</span><span class="p">))</span>

<span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="s1">&#39;LMR2.1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;snapshot&#39;</span><span class="p">:</span><span class="n">snapshot_data</span><span class="p">,</span> 
                               <span class="s1">&#39;ps_atloc&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;full&#39;</span><span class="p">:</span><span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">surftemp_mean</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">surftemp_mean</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
                                                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LMR2.1&#39;</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">clean_ts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)}}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cmip6">
<h3>CMIP6<a class="headerlink" href="#cmip6" title="Permalink to this heading">#</a></h3>
<p>Now we’ll return to the annualized anomaly calculation we did earlier to pull the spatial snapshot at <code class="docutils literal notranslate"><span class="pre">time_pt</span></code> and the time series at <code class="docutils literal notranslate"><span class="pre">lat</span></code>,<code class="docutils literal notranslate"><span class="pre">lon</span></code>  for each of our CMIP6 models. Pulling all of these pieces together will make the plotting easier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># this may take ~5 minutes</span>
<span class="k">for</span> <span class="n">institution</span> <span class="ow">in</span> <span class="n">annualized_anomaly_spatial</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">exp_d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="n">institution</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># select spatial distribution at time_pt</span>
        <span class="k">if</span> <span class="n">time_pt</span> <span class="ow">in</span> <span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="n">institution</span><span class="p">][</span><span class="n">exp</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
            <span class="n">snapshot_anom</span> <span class="o">=</span> <span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="n">institution</span><span class="p">][</span><span class="n">exp</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">time_pt</span><span class="p">})</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        
        <span class="c1"># select time series at lat,lon location</span>
        <span class="n">ts_atloc</span> <span class="o">=</span> <span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="n">institution</span><span class="p">][</span><span class="n">exp</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">},</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">annualized_anomaly_spatial</span><span class="p">[</span><span class="n">institution</span><span class="p">][</span><span class="n">exp</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)})</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">exp_d</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ts_atloc</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ts_atloc</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> 
                                  <span class="n">clean_ts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">institution</span><span class="p">,</span> <span class="n">exp</span><span class="p">]),</span>
                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">institution</span><span class="p">]</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;snapshot&#39;</span><span class="p">:</span><span class="n">snapshot_anom</span><span class="p">,</span> <span class="s1">&#39;ps_atloc&#39;</span><span class="p">:</span><span class="n">exp_d</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2min 38s, sys: 47.3 s, total: 3min 26s
Wall time: 9min 55s
</pre></div>
</div>
</div>
</div>
</section>
<section id="combined-figure">
<h3>Combined figure<a class="headerlink" href="#combined-figure" title="Permalink to this heading">#</a></h3>
<p>Finally, we’ll build the figure. For more details about building filled contour maps and wrangling color bars, check out <a class="reference internal" href="../lifehacks/spatial_snapshots_xarray_bonuses.html"><span class="doc std std-doc">this lifehack notebook</span></a> and for more on dashboards, check out <a class="reference internal" href="VICS_dashboard.html"><span class="doc std std-doc">this science bit</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_scalar_mappable</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ax_norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">lims</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">lims</span><span class="p">),</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">ax_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">ax_sm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">ax_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">ax_cmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax_sm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lims</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;snapshot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cmip6_snapshot_ps</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">lims</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;snapshot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cmip6_snapshot_ps</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

<span class="c1"># establish scale</span>
<span class="n">ax2_Li_1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
<span class="n">ax2_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ax2_Li_1</span><span class="p">,</span> <span class="n">ax2_Li_1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># make scalar mappable</span>
<span class="n">ax2_sm</span> <span class="o">=</span> <span class="n">make_scalar_mappable</span><span class="p">([</span><span class="n">ax2_Li_1</span><span class="p">,</span> <span class="o">-</span><span class="n">ax2_Li_1</span><span class="p">],</span> <span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">cf2_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">ax2_sm</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="s1">&#39;norm&#39;</span> <span class="p">:</span> <span class="n">ax2_sm</span><span class="o">.</span><span class="n">norm</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">.2</span><span class="p">,</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">.25</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="c1"># add subplot with specified map projection and coastlines (GeoAxes)</span>
<span class="n">gs_squares</span> <span class="o">=</span> <span class="p">[</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">sqr</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">sqr</span> <span class="ow">in</span> <span class="n">gs_squares</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;LMR2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;MIROC&#39;</span><span class="p">,</span> <span class="s1">&#39;MPI&#39;</span><span class="p">,</span> <span class="s1">&#39;MRI&#39;</span><span class="p">]):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
    <span class="c1"># place data on coordinate system with continuous x axis (longitude axis)</span>
    <span class="n">tas_c</span><span class="p">,</span> <span class="n">lonc</span> <span class="o">=</span> <span class="n">cutil</span><span class="o">.</span><span class="n">add_cyclic_point</span><span class="p">(</span><span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;snapshot&#39;</span><span class="p">],</span> <span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;snapshot&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
    <span class="c1"># plot contourf on ax2 (geosubplot)</span>
    <span class="n">cf2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lonc</span><span class="p">,</span><span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;snapshot&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="n">tas_c</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span><span class="n">nc</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">ax2_levels</span><span class="p">,</span> 
                       <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">**</span><span class="n">cf2_kwargs</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tam_lon</span><span class="p">,</span> <span class="n">tam_lat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>


<span class="c1"># add annotations (colorbar, title)</span>
<span class="n">ax2_cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">cb2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax2_sm</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">ax2_cb</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\xb0</span><span class="s2">C&quot;</span><span class="p">,</span> 
                   <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">loc</span> <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax2_levels</span><span class="p">)</span> <span class="k">if</span> <span class="n">ik</span><span class="o">%</span><span class="k">2</span>&gt;0])
<span class="n">cb2</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>                     

<span class="c1"># time series</span>
<span class="n">ax_ts</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax_ts</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time_pt</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">MCrun_ps</span> <span class="ow">in</span> <span class="n">tmp_pss</span><span class="p">:</span>
    <span class="n">MCrun_ps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_ts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.15</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

<span class="c1"># CMIP6 trajectories</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cmip6_snapshot_ps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ps_atloc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cmip6_snapshot_ps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ps_atloc&#39;</span><span class="p">][</span><span class="n">exp</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_ts</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
        
<span class="n">ax_ts</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax_ts</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">2014</span><span class="p">])</span>
<span class="n">ax_ts</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Annualized TAS anomaly (</span><span class="se">\xb0</span><span class="s1">C)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7b6f22005c72b1adfb819255a1a77cb397deb4800870136ec4e556b89a9c9ae5.png" src="../../_images/7b6f22005c72b1adfb819255a1a77cb397deb4800870136ec4e556b89a9c9ae5.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>Comparing model output to data is a critical step in assessing how well a physics-based model describes the Earth system. Here we demonstrated how to look at time series data next to spatial snapshots to tease out the details behind the larger patterns. There are many more potential things we could do with this. In future notebooks, we will:</p>
<ul class="simple">
<li><p>map the multivariate response to volcanic eruptions (see <a class="reference internal" href="VICS_dashboard.html"><span class="doc std std-doc">VICS dashboards</span></a>)</p></li>
<li><p>analyze the main modes of climate variability in reconstructions and simulations.</p></li>
</ul>
</section>
<section id="resources-and-references">
<h2>Resources and references<a class="headerlink" href="#resources-and-references" title="Permalink to this heading">#</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><em>Citations</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Hakim, G. J., Emile-Geay, J., Steig, E. J., Noone, D., Anderson, D. M., Tardif, R., Steiger, N., and Perkins, W. A. (2016), The last millennium climate reanalysis project: Framework and first results, J. Geophys. Res. Atmos., 121, 6745– 6764, doi:10.1002/2016JD024751.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tardif, R., Hakim, G. J., Perkins, W. A., Horlick, K. A., Erb, M. P., Emile-Geay, J., Anderson, D. M., Steig, E. J., and Noone, D.: Last Millennium Reanalysis with an expanded proxy database and seasonal proxy modeling, Clim. Past, 15, 1251–1273,  https://doi.org/10.5194/cp-15-1251-2019 , 2019.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Neukom, R., L. A. Barboza, M. P. Erb, F. Shi, J. Emile-Geay, M. N. Evans, J. Franke, D. S. Kaufman, L. Lücke, K. Rehfeld, A. Schurer, F. Zhu, S. Br ̈onnimann, G. J. Hakim, B. J. Henley, F. C. Ljungqvist, N. McKay, V. Valler, and L. von Gunten (2019), Consistent multidecadal variability in global temperature reconstructions and simulations over the common era, Nature Geoscience, 12(8), 643–649, doi:10.1038/s41561-019-0400-0.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Kageyama, M., Braconnot, P., Harrison, S. P., Haywood, A. M., Jungclaus, J. H., Otto-Bliesner, B. L., Peterschmitt, J.-Y., Abe-Ouchi, A., Albani, S., Bartlein, P. J., Brierley, C., Crucifix, M., Dolan, A., Fernandez-Donado, L., Fischer, H., Hopcroft, P. O., Ivanovic, R. F., Lambert, F., Lunt, D. J., Mahowald, N. M., Peltier, W. R., Phipps, S. J., Roche, D. M., Schmidt, G. A., Tarasov, L., Valdes, P. J., Zhang, Q., and Zhou, T.: The PMIP4 contribution to CMIP6 – Part 1: Overview and over-arching analysis plan, Geosci. Model Dev., 11, 1033–1057, https://doi.org/10.5194/gmd-11-1033-2018, 2018.</p></td>
</tr>
</tbody>
</table>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-paleobook-dev-py"
        },
        kernelOptions: {
            name: "conda-env-paleobook-dev-py",
            path: "./notebooks/science_bits"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-paleobook-dev-py'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../lifehacks/widget_primer.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">A short introduction to widgets</p>
      </div>
    </a>
    <a class="right-next"
       href="VICS_dashboard.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Visualizing multivariate, spatio-temporal information in the Cloud with widgets</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-model-comparison-of-global-mean-surface-temperature">Data-model comparison of global-mean surface temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#last-millennium-reanalysis-project-lmr">Last Millennium Reanalysis Project (LMR)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip6-pmip4">CMIP6 &amp; PMIP4</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cloud-ready-data">Cloud-ready data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pulling-data">Pulling Data</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#google-cloud">Google Cloud</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pangeo-forge">Pangeo-Forge</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-data">Processing data</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#miroc">MIROC</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#mri">MRI</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#mpi">MPI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-simulations-to-reconstructions">Comparing simulations to reconstructions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-visualization">Spatial Visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lmr">LMR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip6">CMIP6</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-figure">Combined figure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-and-references">Resources and references</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jordan Landers (for a start)
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>